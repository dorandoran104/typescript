<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MemberMapper">
  
  <select id="exists">
    SELECT
      COUNT(idx) as count
    FROM member
    WHERE code = #{code}
  </select>
  
  <insert id="insert">
    INSERT INTO member(
      code
      ,name
      ,email
      ,password
      ,address
      ,address_detail
      ,mobile_number
    )VALUES(
      #{code}
      ,#{email}
      ,#{password}
      ,#{address}
      ,#{address_detail}
      ,#{mobile_number}
    )
  </insert>
  
  <!-- 회원 조회 -->
  <select id="select">
    SELECT
      idx
      ,code
      ,email
      ,password
      ,access_token
      ,refresh_token
    FROM member
    <where>
      <if test="code != null and code != ''">
        AND code = #{code}
      </if>
      <if test="email != null and email != ''">
        AND email = #{email}
      </if>
      <if test="idx != null and idx != ''">
        AND idx = #{idx}
      </if>
    </where>
  </select>

  <!-- 회원 update -->
  <update id="update">
    UPDATE member SET
      modify_date = NOW()
      <if test="access_token != null and access_token != ''">
      ,access_token = #{access_token}
      </if>
      <if test="refresh_token != null and refresh_token != ''">
      ,refresh_token = #{refresh_token}
      </if>
    WHERE
      idx = #{idx}
  </update>
</mapper>
