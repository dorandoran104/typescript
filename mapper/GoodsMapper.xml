<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="GoodsMapper">
  <select id="exists">
    SELECT
      COUNT(idx) as count
    FROM goods
    WHERE code = #{code}
  </select>

  <insert id="insert">
    INSERT INTO goods (
      code
      ,name
      ,first_category_idx
      ,second_category_idx
      ,price
      ,tax
      ,total_price
      ,use_yn
      ,sold_out_yn
      ,revealed_yn
    )VALUES(
      #{code}
      ,#{name}
      ,#{first_category_idx}
      ,#{second_category_idx}
      ,#{price}
      ,#{tax}
      ,#{total_price}
      ,#{use_yn}
      ,#{sold_out_yn}
      ,#{revealed_yn}
    )
  </insert>

  <update id="update">
    UPDATE goods 
      <set>
        modify_date = NOW()
        <if test="file_idx != null and file_idx != ''">
        ,file_idx = #{file_idx}
        </if>
      </set>
    WHERE
      idx = #{idx}
  </update>

  <select id="select">
    SELECT
      idx
      ,code
      ,name
      ,total_price
      ,sold_out_yn
      ,file_idx
    FROM goods
    <where>
      AND delete_yn = 'N'
      <if test="category_idx != null and category_idx != ''">
        AND first_category_idx = #{category_idx}
      </if>
    </where>

</mapper>